<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shopick - Product Store</title>
<style>
:root{--pri:#7c4ba6;--pri-dark:#5a2d82;--blue:#2563eb;--blue-dark:#1e40af;--green:#22c55e;--green-dark:#15803d;--red:#ef4444;--red-dark:#b91c1c;--text:#222;}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}
body{background:linear-gradient(135deg,#a8edea,#fed6e3);min-height:100vh;padding:40px 20px 80px;color:var(--text);display:flex;flex-direction:column;align-items:center;}
h1{font-weight:900;font-size:2.4rem;margin-bottom:12px;color:var(--pri-dark);text-align:center;letter-spacing:.5px;}
.shopick-logo{width:160px;height:auto;margin-bottom:30px;border-radius:14px;box-shadow:0 10px 25px rgba(124,75,166,.35);}
.container{background:#fff;max-width:1000px;width:100%;border-radius:20px;box-shadow:0 12px 40px rgba(0,0,0,.12);padding:30px 35px 40px;overflow:hidden;}
#searchBox{width:100%;padding:14px 18px;font-size:1.05rem;border:2px solid var(--pri);border-radius:16px;margin-bottom:22px;font-weight:600;}
#searchBox:focus{outline:none;border-color:var(--pri-dark);box-shadow:0 0 15px #5a2d82aa;background:#fff;}
#adminBar{display:none;gap:10px;margin:10px 0 22px;}
#adminBar .tag{background:#f3e8ff;color:var(--pri-dark);padding:8px 12px;border-radius:999px;font-weight:700;font-size:.9rem;display:inline-flex;align-items:center;gap:6px;}
#adminBar button{background:var(--pri);color:#fff;border:none;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;}
#adminBar button:hover{background:var(--pri-dark);transform:translateY(-1px);}
.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:22px;}
.product-card{background:#fff;border-radius:16px;box-shadow:0 7px 20px rgba(0,0,0,.07);display:flex;flex-direction:column;transition:transform .3s ease, box-shadow .3s ease;overflow:hidden;}
.product-card:hover{transform:translateY(-6px);box-shadow:0 14px 35px rgba(0,0,0,.12);}
.product-img{width:100%;aspect-ratio:4/3;object-fit:cover;border-bottom:2px solid var(--pri);}
.product-info{padding:18px 22px 24px;display:flex;flex-direction:column;justify-content:space-between;gap:10px;}
.product-name{font-size:1.05rem;font-weight:800;color:#3c2a56;min-height:44px;line-height:1.25;}
.product-desc{font-size:.87rem;color:#555;min-height:38px;line-height:1.35;}
.product-price{color:var(--pri);font-size:1.1rem;font-weight:800;}
.btns{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;}
.btn{padding:11px 16px;border-radius:12px;font-weight:800;font-size:.98rem;cursor:pointer;flex:1;display:flex;align-items:center;justify-content:center;gap:6px;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.25);border:none;transition:.2s transform;}
.btn:active{transform:translateY(1px);}
.btn-blue{background:var(--blue);}.btn-blue:hover{background:var(--blue-dark);}
.btn-green{background:var(--green);}.btn-green:hover{background:var(--green-dark);}
.btn-red{background:var(--red);}.btn-red:hover{background:var(--red-dark);}
.btn-ghost{background:#f3f4f6;color:#111827;}.btn-ghost:hover{filter:brightness(.95);}
#cartBtn{position:fixed;top:20px;right:20px;background:var(--blue);color:#fff;border:none;border-radius:50%;width:56px;height:56px;font-size:24px;cursor:pointer;display:flex;justify-content:center;align-items:center;z-index:9999;box-shadow:0 8px 22px rgba(37,99,235,.35);}
#cartCount{position:absolute;top:4px;right:4px;background:var(--red);color:#fff;font-size:12px;font-weight:800;border-radius:50%;width:18px;height:18px;display:none;justify-content:center;align-items:center;}
#cartPanel{position:fixed;top:80px;right:20px;width:320px;max-height:70vh;background:#fff;border-radius:20px;box-shadow:0 14px 40px rgba(0,0,0,.2);padding:20px;overflow-y:auto;display:none;flex-direction:column;z-index:9998;}
#cartPanel h2{text-align:center;color:var(--pri-dark);margin-bottom:12px;}
.cart-item{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #eee;padding:8px 0;}
.cart-item-name{font-weight:700;color:#3c2a56;max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.cart-item-price{font-weight:800;color:var(--pri);margin-left:10px;min-width:70px;text-align:right;}
.cart-item-remove{background:transparent;border:none;color:var(--red);font-weight:900;font-size:20px;cursor:pointer;padding:0 6px;}
#cartTotal{text-align:right;font-weight:900;font-size:1.15rem;color:var(--blue);margin:10px 0;}
#closeCartBtn{background:var(--red);color:#fff;border:none;border-radius:14px;padding:10px 16px;cursor:pointer;font-weight:800;}
#closeCartBtn:hover{background:var(--red-dark);}
#toast{position:fixed;top:20px;right:20px;background:var(--blue);color:#fff;padding:14px 18px;border-radius:12px;font-weight:800;font-size:.98rem;opacity:0;pointer-events:none;transform:translateY(-20px);z-index:10000;box-shadow:0 8px 22px rgba(0,0,0,.18);}
#toast.show{opacity:1;transform:translateY(0);}
#loginFormContainer{background:#fff;padding:20px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,.15);margin-bottom:20px;}
#loginFormContainer input{width:100%;padding:12px;margin:6px 0;border-radius:12px;border:2px solid var(--pri);}
#loginFormContainer button{width:100%;padding:12px;border:none;border-radius:12px;background:var(--pri);color:#fff;font-weight:700;margin-top:10px;cursor:pointer;}
#loginFormContainer button:hover{background:var(--pri-dark);}
</style>
</head>
<body>

<h1>Shopick</h1>
<img src="shopick-logo.png" alt="Shopick Logo" class="shopick-logo">

<div id="loginFormContainer">
<h3>Admin Login</h3>
<input type="email" id="adminEmail" placeholder="Email">
<input type="password" id="adminPass" placeholder="Password">
<button id="adminLoginBtn">Login</button>
</div>

<div class="container">
<div id="adminBar"><span class="tag">ðŸ”’ Admin Mode</span><button id="toggleAddForm">+ Add New Product</button><button id="logoutBtn" class="btn-ghost">Logout</button></div>

<div id="adminForm" style="display:none; margin:10px 0 20px; padding:16px; border:2px dashed #e6d7fa; border-radius:16px; background:#faf7ff;">
<form id="addProductForm" autocomplete="off">
<input type="text" id="productName" placeholder="Product Name" required><br><br>
<input type="number" id="productPrice" placeholder="Price" min="1" required><br><br>
<textarea id="productDesc" placeholder="Description" rows="4" required></textarea><br><br>
<input type="file" id="productImages" accept="image/*" multiple><br><br>
<button type="submit" class="btn btn-green" style="width:100%;">Add Product</button>
</form>
</div>

<input type="text" id="searchBox" placeholder="Search product by name...">
<div class="products-grid" id="productsGrid"></div>
</div>

<button id="cartBtn">ðŸ›’ <div id="cartCount">0</div></button>
<div id="cartPanel">
<h2>Your Cart</h2>
<div id="cartItems"></div>
<div id="cartTotal">Total: Rs 0</div>
<button id="closeCartBtn">Close Cart</button>
</div>

<div id="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyBzACfUbTk5cakaIx5RChdGZOc2J8rg_9U",
  authDomain: "shopick-admin.firebaseapp.com",
  projectId: "shopick-admin",
  storageBucket: "shopick-admin.appspot.com",
  messagingSenderId: "567178958366",
  appId: "1:567178958366:web:XXX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);
const storage = getStorage(app);

let currentUser = null;
let cart = [];

// Toast
function showToast(msg){ const t=document.getElementById('toast'); t.innerText=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2500);}

// Admin login
document.getElementById('adminLoginBtn').addEventListener('click',async ()=>{
  const email=document.getElementById('adminEmail').value;
  const pass=document.getElementById('adminPass').value;
  try{
    const userCred=await signInWithEmailAndPassword(auth,email,pass);
    currentUser=userCred.user;
    document.getElementById('loginFormContainer').style.display='none';
    document.getElementById('adminBar').style.display='flex';
    document.getElementById('adminForm').style.display='block';
    showToast('Admin logged in');
    fetchProducts();
  }catch(err){console.error(err); showToast('Login failed');}
});

// Logout
document.getElementById('logoutBtn').addEventListener('click',async ()=>{
  await signOut(auth);
  currentUser=null;
  document.getElementById('loginFormContainer').style.display='block';
  document.getElementById('adminBar').style.display='none';
  document.getElementById('adminForm').style.display='none';
  showToast('Admin logged out');
  fetchProducts();
});

// Toggle add form
document.getElementById('toggleAddForm').addEventListener('click',()=>{
  const f=document.getElementById('adminForm');
  f.style.display=f.style.display==='none'?'block':'none';
});

// Add product
document.getElementById('addProductForm').addEventListener('submit',async e=>{
  e.preventDefault();
  const name=document.getElementById('productName').value;
  const price=parseInt(document.getElementById('productPrice').value);
  const desc=document.getElementById('productDesc').value;
  const files=document.getElementById('productImages').files;

  const imgURLs=[];
  for(let i=0;i<files.length;i++){
    const imgRef=ref(storage,`products/${Date.now()}_${files[i].name}`);
    await uploadBytes(imgRef,files[i]);
    const url=await getDownloadURL(imgRef);
    imgURLs.push(url);
  }

  await addDoc(collection(db,'products'),{name,price,desc,imgs:imgURLs});
  showToast('Product added');
  document.getElementById('addProductForm').reset();
  fetchProducts();
});

// Fetch products
async function fetchProducts(){
  const grid=document.getElementById('productsGrid');
  grid.innerHTML='';
  const snapshot=await getDocs(collection(db,'products'));
  snapshot.forEach(docSnap=>{
    const data=docSnap.data();
    const card=document.createElement('div'); card.className='product-card';
    const img=data.imgs&&data.imgs.length?data.imgs[0]:'';
    card.innerHTML=`
      <img src="${img}" class="product-img">
      <div class="product-info">
        <div class="product-name">${data.name}</div>
        <div class="product-desc">${data.desc}</div>
        <div class="product-price">Rs ${data.price}</div>
      </div>
      <div class="btns"><button class="btn btn-blue buyBtn">Buy Now</button></div>
    `;
    // Admin buttons
    if(currentUser){
      const delBtn=document.createElement('button'); delBtn.className='btn btn-red'; delBtn.innerText='Delete';
      delBtn.onclick=()=>{deleteDoc(doc(db,'products',docSnap.id)).then(()=>fetchProducts());};
      const editBtn=document.createElement('button'); editBtn.className='btn btn-green'; editBtn.innerText='Edit';
      editBtn.onclick=()=>{
        document.getElementById('productName').value=data.name;
        document.getElementById('productPrice').value=data.price;
        document.getElementById('productDesc').value=data.desc;
        document.getElementById('adminForm').style.display='block';
        showToast('Edit product and submit');
        document.getElementById('addProductForm').onsubmit=async ev=>{
          ev.preventDefault();
          await updateDoc(doc(db,'products',docSnap.id),{
            name:document.getElementById('productName').value,
            price:parseInt(document.getElementById('productPrice').value),
            desc:document.getElementById('productDesc').value
          });
          showToast('Product updated');
          document.getElementById('addProductForm').reset();
          fetchProducts();
        };
      };
      card.querySelector('.btns').appendChild(editBtn);
      card.querySelector('.btns').appendChild(delBtn);
    }

    // Buy now
    card.querySelector('.buyBtn').onclick=()=>{window.open('https://wa.me/0000000000?text=I want to buy '+encodeURIComponent(data.name),'_blank');};
    grid.appendChild(card);
  });
}

// Search
document.getElementById('searchBox').addEventListener('input',e=>{
  const term=e.target.value.toLowerCase();
  document.querySelectorAll('.product-card').forEach(card=>{
    const pname=card.querySelector('.product-name').textContent.toLowerCase();
    card.style.display=pname.includes(term)?'flex':'none';
  });
});

// Cart system
const cartBtn=document.getElementById('cartBtn');
const cartPanel=document.getElementById('cartPanel');
const cartItems=document.getElementById('cartItems');
const cartTotal=document.getElementById('cartTotal');
const closeCartBtn=document.getElementById('closeCartBtn');

cartBtn.addEventListener('click',()=>cartPanel.style.display='flex');
closeCartBtn.addEventListener('click',()=>cartPanel.style.display='none');

function addToCart(product){cart.push(product);updateCartUI();showToast(product.name+' added to cart');}
function removeFromCart(i){const removed=cart.splice(i,1)[0];updateCartUI();showToast(removed.name+' removed from cart');}
function updateCartUI(){cartItems.innerHTML='';let total=0;cart.forEach((item,i)=>{total+=item.price; const div=document.createElement('div'); div.className='cart-item'; div.innerHTML=`<span class="cart-item-name">${item.name}</span><span class="cart-item-price">Rs ${item.price}</span><button class="cart-item-remove">&times;</button>`; div.querySelector('.cart-item-remove').onclick=()=>removeFromCart(i); cartItems.appendChild(div);}); cartTotal.innerText='Total: Rs '+total; document.getElementById('cartCount').style.display=cart.length?'flex':'none'; document.getElementById('cartCount').innerText=cart.length;}
fetchProducts();
</script>

</body>
</html>
